# JavaScript 模块化项目代码生成的最佳实践

1. **始终为浏览器 ES 模块指定文件扩展名**
   - 在浏览器环境中，所有的 import 语句必须包含 `.js` 扩展名
   - 错误例：`import { Component } from './Component'`
   - 正确例：`import { Component } from './Component.js'`

2. **保持单一实例化原则**
   - 避免多处创建同一类的实例，特别是管理器类
   - 使用依赖注入模式将实例传递给需要的组件

3. **确保方法实现与接口调用一致**
   - 在调用方法前，确保该方法在目标类中已实现
   - 为所有被引用的方法提供实现或占位符

4. **添加健壮的空值检查**
   - 在访问 DOM 元素或调用可能不存在的方法前进行检查
   - 使用可选链操作符 `?.` 和空值合并操作符 `??` 增强代码健壮性

5. **提供合理的默认行为**
   - 实现模块时，为关键功能提供基本的默认实现
   - 确保在依赖未初始化或数据缺失时系统仍能正常运行

6. **明确类之间的依赖关系**
   - 构造函数应明确声明和初始化所有必要依赖
   - 避免隐式依赖和全局状态

7. **确保 HTML 与 JavaScript 交互点一致**
   - 确认所有 JavaScript 引用的 DOM 元素 ID 在 HTML 中存在
   - 动态创建缺失的 UI 元素而不是假设它们已存在

8. **测试关键路径**
   - 确保应用初始化、用户交互和数据流等关键路径有完整实现
   - 提供合理的占位符功能直到真实功能实现

9. **使用类型注释或 JSDoc**
    - 为函数参数和返回值添加类型注释增加代码可读性
    - 明确方法期望接收的参数类型和结构

10. **优化测试启动性能**
    - 明确配置测试环境，尤其是使用ESM模块时
    - 减少不必要的模块加载，使用具体的`moduleDirectories`和`testMatch`
    - 避免在测试中过度使用模块化导入，尤其是大型依赖

11. **采用依赖注入设计模式提高可测试性**
    - 不要在类内部直接引用全局对象（如window），而是通过构造函数参数注入
    - 设计API时允许依赖被替换，比如`new Manager(customAPIClient)`
    - 将外部API的调用抽象为可替换的接口，便于测试时进行模拟

12. **恰当处理浏览器API在测试环境中的模拟**
    - 不要假设所有浏览器API在测试环境中可用，总是提供可测试的替代方案
    - 为浏览器专有API创建清晰的抽象层，以便在测试中进行模拟
    - 在使用File System Access API等新特性时，确保提供适当的降级方案

13. **注意模块加载顺序和依赖关系**
    - 确保setup文件在正确的时机被加载，尤其是在测试环境中
    - 使用明确的顺序初始化依赖，避免循环依赖
    - 理解ESM与CommonJS模块加载的差异，特别是在混合使用的项目中
